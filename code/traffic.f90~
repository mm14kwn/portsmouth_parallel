PROGRAM TRAFFIC
IMPLICIT NONE

INTEGER, PARAMETER :: real_8_30 = SELECTED_REAL_KIND(P=8, R=30)
INTEGER :: N, TIMESTEPS, T, I
REAL(KIND=real_8_30) :: TOL
REAL(KIND=real_8_30), DIMENSION(:), ALLOCATABLE :: DUMMYVECTOR
REAL(KIND=real_8_30), DIMENSION(:,:), ALLOCATABLE :: GRID

PRINT*, 'INPUT NUMBER OF TIMESTEPS'
READ*, TIMESTEPS

PRINT*, 'INPUT NUMBER OF GRIDS'
READ*, N

PRINT*, 'INPUT CHECK TOLERANCE'
READ*, TOL

ALLOCATE(DUMMYVECTOR(N))
ALLOCATE(GRID(N,TIMESTEPS))

DO I=1,N
GRID(I,1)=NINT(RAND())
END DO

DO T=1,TIMESTEPS-1
   DUMMYVECTOR=0
   DO I=1,N-1
      IF (ABS(1-GRID(I,T))<=TOL) THEN
         IF (ABS(GRID(I+1,T))<=TOL) THEN
            DUMMYVECTOR(I)=0
            DUMMYVECTOR(I+1)=1
         ELSE
            DUMMYVECTOR(I)=1
         END IF
      END IF
   END DO
   DO I=1,N
      GRID(I,T+1)=DUMMYVECTOR(I)
   END DO
END DO

PRINT*, 'Run Complete - Writing to file'
OPEN(1, file='./cars.txt',status='new')
DO T=1,TIMESTEPS
   DO I=1,N
      WRITE(1,*) GRID(I,T)
   END DO
END DO
END PROGRAM TRAFFIC
